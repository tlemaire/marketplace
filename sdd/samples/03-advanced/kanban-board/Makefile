# Kanban Management System - Makefile
# Enterprise Real-Time Collaborative Development Workflow

.PHONY: help install dev build test test:unit test:integration test:e2e test:load clean seed lint format security deploy docker:build docker:run docker:stop

# Default target
help:
	@echo "ğŸ¯ Kanban Management System - Enterprise Development Commands"
	@echo ""
	@echo "ğŸ”§ Setup & Installation:"
	@echo "  install         Install all dependencies"
	@echo "  setup           Setup development environment"
	@echo "  seed            Seed database with sample data"
	@echo ""
	@echo "ğŸš€ Development:"
	@echo "  dev             Start development servers (backend + frontend)"
	@echo "  dev:backend     Start backend development server"
	@echo "  dev:frontend    Start frontend development server"
	@echo "  dev:sockets     Start real-time WebSocket server"
	@echo ""
	@echo "ğŸ§ª Testing:"
	@echo "  test            Run all tests"
	@echo "  test:unit       Run unit tests"
	@echo "  test:integration Run integration tests"
	@echo "  test:e2e        Run end-to-end tests"
	@echo "  test:load       Run load tests"
	@echo "  test:sockets    Test WebSocket functionality"
	@echo ""
	@echo "ğŸ” Quality & Security:"
	@echo "  lint            Run ESLint"
	@echo "  format          Format code with Prettier"
	@echo "  security        Run security vulnerability scan"
	@echo "  quality:check   Run comprehensive quality validation"
	@echo ""
	@echo "ğŸ—ï¸  Build & Deployment:"
	@echo "  build           Build production application"
	@echo "  build:backend   Build backend for production"
	@echo "  build:frontend  Build frontend for production"
	@echo "  deploy          Deploy to production"
	@echo "  deploy:staging  Deploy to staging environment"
	@echo ""
	@echo "ğŸ³ Docker:"
	@echo "  docker:build    Build Docker images"
	@echo "  docker:run      Run application with Docker"
	@echo "  docker:stop     Stop Docker containers"
	@echo "  docker:dev      Run development environment with Docker"
	@echo ""
	@echo "ğŸ—„ï¸  Database:"
	@echo "  db:migrate      Run database migrations"
	@echo "  db:seed         Seed database with sample data"
	@echo "  db:reset        Reset database"
	@echo "  db:backup       Backup database"
	@echo "  db:restore      Restore database from backup"

# Installation
install:
	npm install
	cd client && npm install

# Setup development environment
setup:
	@echo "ğŸ”§ Setting up Kanban development environment..."
	cp specs/001-kanban-management-system/.env.example .env
	npm run setup
	@echo "âœ… Development environment setup complete!"

# Seed database with sample data
seed:
	@echo "ğŸŒ± Seeding database with sample kanban data..."
	npm run seed
	@echo "âœ… Database seeded successfully!"

# Development
dev:
	@echo "ğŸš€ Starting full development environment..."
	npm run dev

dev:backend:
	@echo "ğŸ–¥ï¸  Starting backend development server..."
	npm run dev:backend

dev:frontend:
	@echo "ğŸŒ Starting frontend development server..."
	cd client && npm run dev

dev:sockets:
	@echo "ğŸ”Œ Starting real-time WebSocket server..."
	npm run dev:sockets

# Testing
test:
	@echo "ğŸ§ª Running all tests..."
	npm run test

test:unit:
	@echo "ğŸ”¬ Running unit tests..."
	npm run test:unit

test:integration:
	@echo "ğŸ”— Running integration tests..."
	npm run test:integration

test:e2e:
	@echo "ğŸ­ Running end-to-end tests..."
	npm run test:e2e

test:load:
	@echo "ğŸš€ Running load tests..."
	npm run test:load

test:sockets:
	@echo "ğŸ”Œ Testing WebSocket functionality..."
	npm run test:sockets

# Real-time specific testing
test:realtime:
	@echo "âš¡ Running real-time collaboration tests..."
	npm run test:realtime

test:concurrent:
	@echo "ğŸ‘¥ Running concurrent user tests..."
	npm run test:concurrent

# Quality & Security
lint:
	@echo "ğŸ” Running ESLint..."
	npm run lint

format:
	@echo "ğŸ¨ Formatting code with Prettier..."
	npm run format

security:
	@echo "ğŸ”’ Running security vulnerability scan..."
	npm audit
	npm audit:fix || true

quality:check:
	@echo "ğŸ† Running comprehensive quality validation..."
	npm run quality:check

# Build & Deployment
build:
	@echo "ğŸ—ï¸  Building production application..."
	npm run build

build:backend:
	@echo "ğŸ–¥ï¸  Building backend for production..."
	npm run build:backend

build:frontend:
	@echo "ğŸŒ Building frontend for production..."
	cd client && npm run build

deploy:
	@echo "ğŸš€ Deploying to production..."
	npm run deploy

deploy:staging:
	@echo "ğŸ”§ Deploying to staging environment..."
	npm run deploy:staging

# Database operations
db:migrate:
	@echo "ğŸ—„ï¸  Running database migrations..."
	npm run db:migrate

db:seed:
	@echo "ğŸŒ± Seeding database..."
	npm run db:seed

db:reset:
	@echo "â™»ï¸  Resetting database..."
	npm run db:reset

db:backup:
	@echo "ğŸ’¾ Backing up database..."
	npm run db:backup

db:restore:
	@echo "ğŸ“¥ Restoring database from backup..."
	npm run db:restore

# Docker operations
docker:build:
	@echo "ğŸ³ Building Docker images..."
	docker-compose build

docker:run:
	@echo "ğŸ³ Running application with Docker..."
	docker-compose up -d

docker:stop:
	@echo "ğŸ›‘ Stopping Docker containers..."
	docker-compose down

docker:dev:
	@echo "ğŸ³ Running development environment with Docker..."
	docker-compose -f docker-compose.dev.yml up

docker:prod:
	@echo "ğŸ³ Running production environment with Docker..."
	docker-compose -f docker-compose.prod.yml up -d

# Real-time development helpers
sockets:monitor:
	@echo "ğŸ“Š Monitoring WebSocket connections..."
	npm run sockets:monitor

performance:test:
	@echo "âš¡ Running performance tests..."
	npm run performance:test

load:test:
	@echo "ğŸš€ Running load tests with realistic scenarios..."
	npm run load:test

concurrent:test:
	@echo "ğŸ‘¥ Running concurrent user tests..."
	npm run concurrent:test

# Quality gates
pre-commit: lint security test:unit
	@echo "âœ… Pre-commit quality checks passed"

pre-push: test integration test:e2e quality:check
	@echo "âœ… Pre-push quality checks passed"

# Cleanup
clean:
	@echo "ğŸ§¹ Cleaning up..."
	rm -rf node_modules client/node_modules
	rm -rf dist client/dist
	rm -rf logs
	rm -rf uploads
	@echo "âœ… Cleanup complete!"

# Monitoring and diagnostics
monitor:
	@echo "ğŸ“Š Starting monitoring dashboard..."
	npm run monitor

diagnostics:
	@echo "ğŸ” Running system diagnostics..."
	npm run diagnostics

health:
	@echo "ğŸ¥ Checking application health..."
	npm run health:check

# Development helpers
logs:
	@echo "ğŸ“‹ Following application logs..."
	tail -f logs/app.log

error:logs:
	@echo "âŒ Following error logs..."
	tail -f logs/error.log

socket:logs:
	@echo "ğŸ”Œ Following WebSocket logs..."
	tail -f logs/socket.log

# Environment management
env:dev:
	@echo "ğŸ”§ Setting development environment..."
	cp specs/001-kanban-management-system/.env.example .env.development
	@echo "âœ… Development environment configured"

env:prod:
	@echo "ğŸš€ Setting production environment..."
	cp specs/001-kanban-management-system/.env.example .env.production
	@echo "âš ï¸  Remember to update production environment variables!"

env:test:
	@echo "ğŸ§ª Setting test environment..."
	cp specs/001-kanban-management-system/.env.example .env.test
	@echo "âœ… Test environment configured"

# CI/CD helpers
ci:install:
	@echo "ğŸ“¦ Installing for CI environment..."
	npm ci --production=false

ci:test:
	@echo "ğŸ§ª Running CI tests..."
	npm run ci:test

ci:build:
	@echo "ğŸ—ï¸  Building for CI..."
	npm run ci:build

ci:deploy:
	@echo "ğŸš€ Deploying from CI..."
	npm run ci:deploy

# Production operations
prod:backup:
	@echo "ğŸ’¾ Creating production backup..."
	npm run prod:backup

prod:logs:
	@echo "ğŸ“‹ Following production logs..."
	npm run prod:logs

prod:monitor:
	@echo "ğŸ“Š Production monitoring..."
	npm run prod:monitor

prod:scale:
	@echo "ğŸ“ˆ Scaling production..."
	npm run prod:scale

# Performance optimization
optimize:images:
	@echo "ğŸ–¼ï¸  Optimizing images..."
	npm run optimize:images

optimize:database:
	@echo "ğŸ—„ï¸  Optimizing database..."
	npm run optimize:database

optimize:assets:
	@echo "ğŸ“¦ Optimizing assets..."
	npm run optimize:assets

# Security operations
security:audit:
	@echo "ğŸ”’ Running security audit..."
	npm run security:audit

security:patch:
	@echo "ğŸ”§ Applying security patches..."
	npm audit fix

security:scan:
	@echo "ğŸ” Running security scan..."
	npm run security:scan

# Analytics and reporting
analytics:report:
	@echo "ğŸ“Š Generating analytics report..."
	npm run analytics:report

performance:report:
	@echo "âš¡ Generating performance report..."
	npm run performance:report

usage:report:
	@echo "ğŸ“ˆ Generating usage report..."
	npm run usage:report

# Development workflow shortcuts
dev:full: install setup seed dev
	@echo "ğŸš€ Full development environment ready!"

test:full: test:unit test:integration test:e2e test:load
	@echo "âœ… All tests completed!"

quality:full: lint format security test:full
	@echo "ğŸ† Full quality validation completed!"

deploy:full: build docker:build docker:run
	@echo "ğŸš€ Full deployment completed!"